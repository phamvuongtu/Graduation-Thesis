{"ast":null,"code":"\"use strict\";\n\n/* --------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n * ------------------------------------------------------------------------------------------ */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SharedArrayReceiverStrategy = exports.SharedArraySenderStrategy = void 0;\nconst cancellation_1 = require(\"./cancellation\");\nvar CancellationState;\n(function (CancellationState) {\n  CancellationState.Continue = 0;\n  CancellationState.Cancelled = 1;\n})(CancellationState || (CancellationState = {}));\nclass SharedArraySenderStrategy {\n  constructor() {\n    this.buffers = new Map();\n  }\n  enableCancellation(request) {\n    if (request.id === null) {\n      return;\n    }\n    const buffer = new SharedArrayBuffer(4);\n    const data = new Int32Array(buffer, 0, 1);\n    data[0] = CancellationState.Continue;\n    this.buffers.set(request.id, buffer);\n    request.$cancellationData = buffer;\n  }\n  async sendCancellation(_conn, id) {\n    const buffer = this.buffers.get(id);\n    if (buffer === undefined) {\n      return;\n    }\n    const data = new Int32Array(buffer, 0, 1);\n    Atomics.store(data, 0, CancellationState.Cancelled);\n  }\n  cleanup(id) {\n    this.buffers.delete(id);\n  }\n  dispose() {\n    this.buffers.clear();\n  }\n}\nexports.SharedArraySenderStrategy = SharedArraySenderStrategy;\nclass SharedArrayBufferCancellationToken {\n  constructor(buffer) {\n    this.data = new Int32Array(buffer, 0, 1);\n  }\n  get isCancellationRequested() {\n    return Atomics.load(this.data, 0) === CancellationState.Cancelled;\n  }\n  get onCancellationRequested() {\n    throw new Error(`Cancellation over SharedArrayBuffer doesn't support cancellation events`);\n  }\n}\nclass SharedArrayBufferCancellationTokenSource {\n  constructor(buffer) {\n    this.token = new SharedArrayBufferCancellationToken(buffer);\n  }\n  cancel() {}\n  dispose() {}\n}\nclass SharedArrayReceiverStrategy {\n  constructor() {\n    this.kind = 'request';\n  }\n  createCancellationTokenSource(request) {\n    const buffer = request.$cancellationData;\n    if (buffer === undefined) {\n      return new cancellation_1.CancellationTokenSource();\n    }\n    return new SharedArrayBufferCancellationTokenSource(buffer);\n  }\n}\nexports.SharedArrayReceiverStrategy = SharedArrayReceiverStrategy;","map":{"version":3,"names":["Object","defineProperty","exports","value","SharedArrayReceiverStrategy","SharedArraySenderStrategy","cancellation_1","require","CancellationState","Continue","Cancelled","constructor","buffers","Map","enableCancellation","request","id","buffer","SharedArrayBuffer","data","Int32Array","set","$cancellationData","sendCancellation","_conn","get","undefined","Atomics","store","cleanup","delete","dispose","clear","SharedArrayBufferCancellationToken","isCancellationRequested","load","onCancellationRequested","Error","SharedArrayBufferCancellationTokenSource","token","cancel","kind","createCancellationTokenSource","CancellationTokenSource"],"sources":["/Users/phamtu/Downloads/Code/OCE/oce-frontend/node_modules/vscode-jsonrpc/lib/common/sharedArrayCancellation.js"],"sourcesContent":["\"use strict\";\n/* --------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n * ------------------------------------------------------------------------------------------ */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SharedArrayReceiverStrategy = exports.SharedArraySenderStrategy = void 0;\nconst cancellation_1 = require(\"./cancellation\");\nvar CancellationState;\n(function (CancellationState) {\n    CancellationState.Continue = 0;\n    CancellationState.Cancelled = 1;\n})(CancellationState || (CancellationState = {}));\nclass SharedArraySenderStrategy {\n    constructor() {\n        this.buffers = new Map();\n    }\n    enableCancellation(request) {\n        if (request.id === null) {\n            return;\n        }\n        const buffer = new SharedArrayBuffer(4);\n        const data = new Int32Array(buffer, 0, 1);\n        data[0] = CancellationState.Continue;\n        this.buffers.set(request.id, buffer);\n        request.$cancellationData = buffer;\n    }\n    async sendCancellation(_conn, id) {\n        const buffer = this.buffers.get(id);\n        if (buffer === undefined) {\n            return;\n        }\n        const data = new Int32Array(buffer, 0, 1);\n        Atomics.store(data, 0, CancellationState.Cancelled);\n    }\n    cleanup(id) {\n        this.buffers.delete(id);\n    }\n    dispose() {\n        this.buffers.clear();\n    }\n}\nexports.SharedArraySenderStrategy = SharedArraySenderStrategy;\nclass SharedArrayBufferCancellationToken {\n    constructor(buffer) {\n        this.data = new Int32Array(buffer, 0, 1);\n    }\n    get isCancellationRequested() {\n        return Atomics.load(this.data, 0) === CancellationState.Cancelled;\n    }\n    get onCancellationRequested() {\n        throw new Error(`Cancellation over SharedArrayBuffer doesn't support cancellation events`);\n    }\n}\nclass SharedArrayBufferCancellationTokenSource {\n    constructor(buffer) {\n        this.token = new SharedArrayBufferCancellationToken(buffer);\n    }\n    cancel() {\n    }\n    dispose() {\n    }\n}\nclass SharedArrayReceiverStrategy {\n    constructor() {\n        this.kind = 'request';\n    }\n    createCancellationTokenSource(request) {\n        const buffer = request.$cancellationData;\n        if (buffer === undefined) {\n            return new cancellation_1.CancellationTokenSource();\n        }\n        return new SharedArrayBufferCancellationTokenSource(buffer);\n    }\n}\nexports.SharedArrayReceiverStrategy = SharedArrayReceiverStrategy;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}