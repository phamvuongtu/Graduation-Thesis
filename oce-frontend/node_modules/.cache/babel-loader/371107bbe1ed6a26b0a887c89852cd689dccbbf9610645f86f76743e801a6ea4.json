{"ast":null,"code":"\"use strict\";\n\n/* --------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n * ------------------------------------------------------------------------------------------ */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Semaphore = void 0;\nconst ral_1 = require(\"./ral\");\nclass Semaphore {\n  constructor(capacity = 1) {\n    if (capacity <= 0) {\n      throw new Error('Capacity must be greater than 0');\n    }\n    this._capacity = capacity;\n    this._active = 0;\n    this._waiting = [];\n  }\n  lock(thunk) {\n    return new Promise((resolve, reject) => {\n      this._waiting.push({\n        thunk,\n        resolve,\n        reject\n      });\n      this.runNext();\n    });\n  }\n  get active() {\n    return this._active;\n  }\n  runNext() {\n    if (this._waiting.length === 0 || this._active === this._capacity) {\n      return;\n    }\n    (0, ral_1.default)().timer.setImmediate(() => this.doRunNext());\n  }\n  doRunNext() {\n    if (this._waiting.length === 0 || this._active === this._capacity) {\n      return;\n    }\n    const next = this._waiting.shift();\n    this._active++;\n    if (this._active > this._capacity) {\n      throw new Error(`To many thunks active`);\n    }\n    try {\n      const result = next.thunk();\n      if (result instanceof Promise) {\n        result.then(value => {\n          this._active--;\n          next.resolve(value);\n          this.runNext();\n        }, err => {\n          this._active--;\n          next.reject(err);\n          this.runNext();\n        });\n      } else {\n        this._active--;\n        next.resolve(result);\n        this.runNext();\n      }\n    } catch (err) {\n      this._active--;\n      next.reject(err);\n      this.runNext();\n    }\n  }\n}\nexports.Semaphore = Semaphore;","map":{"version":3,"names":["Object","defineProperty","exports","value","Semaphore","ral_1","require","constructor","capacity","Error","_capacity","_active","_waiting","lock","thunk","Promise","resolve","reject","push","runNext","active","length","default","timer","setImmediate","doRunNext","next","shift","result","then","err"],"sources":["/Users/phamtu/Downloads/Code/OCE/oce-frontend/node_modules/vscode-jsonrpc/lib/common/semaphore.js"],"sourcesContent":["\"use strict\";\n/* --------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n * ------------------------------------------------------------------------------------------ */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Semaphore = void 0;\nconst ral_1 = require(\"./ral\");\nclass Semaphore {\n    constructor(capacity = 1) {\n        if (capacity <= 0) {\n            throw new Error('Capacity must be greater than 0');\n        }\n        this._capacity = capacity;\n        this._active = 0;\n        this._waiting = [];\n    }\n    lock(thunk) {\n        return new Promise((resolve, reject) => {\n            this._waiting.push({ thunk, resolve, reject });\n            this.runNext();\n        });\n    }\n    get active() {\n        return this._active;\n    }\n    runNext() {\n        if (this._waiting.length === 0 || this._active === this._capacity) {\n            return;\n        }\n        (0, ral_1.default)().timer.setImmediate(() => this.doRunNext());\n    }\n    doRunNext() {\n        if (this._waiting.length === 0 || this._active === this._capacity) {\n            return;\n        }\n        const next = this._waiting.shift();\n        this._active++;\n        if (this._active > this._capacity) {\n            throw new Error(`To many thunks active`);\n        }\n        try {\n            const result = next.thunk();\n            if (result instanceof Promise) {\n                result.then((value) => {\n                    this._active--;\n                    next.resolve(value);\n                    this.runNext();\n                }, (err) => {\n                    this._active--;\n                    next.reject(err);\n                    this.runNext();\n                });\n            }\n            else {\n                this._active--;\n                next.resolve(result);\n                this.runNext();\n            }\n        }\n        catch (err) {\n            this._active--;\n            next.reject(err);\n            this.runNext();\n        }\n    }\n}\nexports.Semaphore = Semaphore;\n"],"mappings":"AAAA,YAAY;;AACZ;AACA;AACA;AACA;AACAA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,SAAS,GAAG,KAAK,CAAC;AAC1B,MAAMC,KAAK,GAAGC,OAAO,CAAC,OAAO,CAAC;AAC9B,MAAMF,SAAS,CAAC;EACZG,WAAWA,CAACC,QAAQ,GAAG,CAAC,EAAE;IACtB,IAAIA,QAAQ,IAAI,CAAC,EAAE;MACf,MAAM,IAAIC,KAAK,CAAC,iCAAiC,CAAC;IACtD;IACA,IAAI,CAACC,SAAS,GAAGF,QAAQ;IACzB,IAAI,CAACG,OAAO,GAAG,CAAC;IAChB,IAAI,CAACC,QAAQ,GAAG,EAAE;EACtB;EACAC,IAAIA,CAACC,KAAK,EAAE;IACR,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;MACpC,IAAI,CAACL,QAAQ,CAACM,IAAI,CAAC;QAAEJ,KAAK;QAAEE,OAAO;QAAEC;MAAO,CAAC,CAAC;MAC9C,IAAI,CAACE,OAAO,CAAC,CAAC;IAClB,CAAC,CAAC;EACN;EACA,IAAIC,MAAMA,CAAA,EAAG;IACT,OAAO,IAAI,CAACT,OAAO;EACvB;EACAQ,OAAOA,CAAA,EAAG;IACN,IAAI,IAAI,CAACP,QAAQ,CAACS,MAAM,KAAK,CAAC,IAAI,IAAI,CAACV,OAAO,KAAK,IAAI,CAACD,SAAS,EAAE;MAC/D;IACJ;IACA,CAAC,CAAC,EAAEL,KAAK,CAACiB,OAAO,EAAE,CAAC,CAACC,KAAK,CAACC,YAAY,CAAC,MAAM,IAAI,CAACC,SAAS,CAAC,CAAC,CAAC;EACnE;EACAA,SAASA,CAAA,EAAG;IACR,IAAI,IAAI,CAACb,QAAQ,CAACS,MAAM,KAAK,CAAC,IAAI,IAAI,CAACV,OAAO,KAAK,IAAI,CAACD,SAAS,EAAE;MAC/D;IACJ;IACA,MAAMgB,IAAI,GAAG,IAAI,CAACd,QAAQ,CAACe,KAAK,CAAC,CAAC;IAClC,IAAI,CAAChB,OAAO,EAAE;IACd,IAAI,IAAI,CAACA,OAAO,GAAG,IAAI,CAACD,SAAS,EAAE;MAC/B,MAAM,IAAID,KAAK,CAAE,uBAAsB,CAAC;IAC5C;IACA,IAAI;MACA,MAAMmB,MAAM,GAAGF,IAAI,CAACZ,KAAK,CAAC,CAAC;MAC3B,IAAIc,MAAM,YAAYb,OAAO,EAAE;QAC3Ba,MAAM,CAACC,IAAI,CAAE1B,KAAK,IAAK;UACnB,IAAI,CAACQ,OAAO,EAAE;UACde,IAAI,CAACV,OAAO,CAACb,KAAK,CAAC;UACnB,IAAI,CAACgB,OAAO,CAAC,CAAC;QAClB,CAAC,EAAGW,GAAG,IAAK;UACR,IAAI,CAACnB,OAAO,EAAE;UACde,IAAI,CAACT,MAAM,CAACa,GAAG,CAAC;UAChB,IAAI,CAACX,OAAO,CAAC,CAAC;QAClB,CAAC,CAAC;MACN,CAAC,MACI;QACD,IAAI,CAACR,OAAO,EAAE;QACde,IAAI,CAACV,OAAO,CAACY,MAAM,CAAC;QACpB,IAAI,CAACT,OAAO,CAAC,CAAC;MAClB;IACJ,CAAC,CACD,OAAOW,GAAG,EAAE;MACR,IAAI,CAACnB,OAAO,EAAE;MACde,IAAI,CAACT,MAAM,CAACa,GAAG,CAAC;MAChB,IAAI,CAACX,OAAO,CAAC,CAAC;IAClB;EACJ;AACJ;AACAjB,OAAO,CAACE,SAAS,GAAGA,SAAS","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}